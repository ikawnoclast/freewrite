#
# before_get_weather
#
#	A freewrite before script to gather the current weather observations 
#	to provide weather-related context to the freewrite session file.
#

# weather data from the closest airport weather observation station
# KAW: move into .freewriterc
weather_url="http://www.weather.gov/xml/current_obs/KLAF.rss"

before_get_weather () {
	local weather=$(mktemp /tmp/todos.XXXXXXXX)
	local weather_report
	curl --silent $weather_url > $weather
	if [ ! -z $weather ]; then
		# extract weather in <title>.*</title>
		weather_report=$(cat $weather | grep '</title>' | tail -1 | \
				 sed -e 's/^\(.*\) at Lafayette.*/\1/')
	else
		weather_report="No data available."
	fi
	cat <<-__EOT__ >> $data_file

	Weather: $weather_report
	__EOT__
	rm -f $weather
}